SELECT c.country, p.category, COUNT(DISTINCT o.order_id) AS orders, SUM(oi.quantity * oi.unit_price * (1 - oi.discount_percent/100)) AS revenue FROM ecommerce.customers c JOIN ecommerce.orders o ON c.customer_id = o.customer_id JOIN ecommerce.order_items oi ON o.order_id = oi.order_id JOIN ecommerce.products p ON oi.product_id = p.product_id GROUP BY c.country, p.category ORDER BY c.country, revenue DESC;
